package session_test

import (
	"testing"

	"github.com/goyal-aman/mailmux/src/session"
)

func TestUpdateFromUser(t *testing.T) {
	/*
		Date: Mon, 29 Dec 2025 18:44:53 +0530
		To: new.user@smtpmux.com
		From: treata@zoho.com
		Subject: test Mon, 29 Dec 2025 18:44:53 +0530
		Message-Id: <20251229184453.033835@amangoyalmba.local>
		X-Mailer: swaks v20240103.0 jetmore.org/john/code/swaks/

		hello user


	*/
	mailDataBytes := []byte{68, 97, 116, 101, 58, 32, 77, 111, 110, 44, 32, 50, 57, 32, 68, 101, 99, 32, 50, 48, 50, 53, 32, 49, 56, 58, 52, 52, 58, 53, 51, 32, 43, 48, 53, 51, 48, 13, 10, 84, 111, 58, 32, 97, 109, 97, 110, 103, 111, 121, 97, 108, 56, 49, 49, 48, 64, 103, 109, 97, 105, 108, 46, 99, 111, 109, 13, 10, 70, 114, 111, 109, 58, 32, 116, 114, 101, 97, 116, 97, 64, 122, 111, 104, 111, 46, 99, 111, 109, 13, 10, 83, 117, 98, 106, 101, 99, 116, 58, 32, 116, 101, 115, 116, 32, 77, 111, 110, 44, 32, 50, 57, 32, 68, 101, 99, 32, 50, 48, 50, 53, 32, 49, 56, 58, 52, 52, 58, 53, 51, 32, 43, 48, 53, 51, 48, 13, 10, 77, 101, 115, 115, 97, 103, 101, 45, 73, 100, 58, 32, 60, 50, 48, 50, 53, 49, 50, 50, 57, 49, 56, 52, 52, 53, 51, 46, 48, 51, 51, 56, 51, 53, 64, 97, 109, 97, 110, 103, 111, 121, 97, 108, 109, 98, 97, 46, 108, 111, 99, 97, 108, 62, 13, 10, 88, 45, 77, 97, 105, 108, 101, 114, 58, 32, 115, 119, 97, 107, 115, 32, 118, 50, 48, 50, 52, 48, 49, 48, 51, 46, 48, 32, 106, 101, 116, 109, 111, 114, 101, 46, 111, 114, 103, 47, 106, 111, 104, 110, 47, 99, 111, 100, 101, 47, 115, 119, 97, 107, 115, 47, 13, 10, 13, 10, 104, 101, 108, 108, 111, 32, 117, 115, 101, 114, 13, 10, 13, 10, 13, 10}
	newMailDataBytes := session.UpdateFromUser(mailDataBytes, "new.user@smtpmux.com")
	expectedArrBytes := []byte{68, 97, 116, 101, 58, 32, 77, 111, 110, 44, 32, 50, 57, 32, 68, 101, 99, 32, 50, 48, 50, 53, 32, 49, 56, 58, 52, 52, 58, 53, 51, 32, 43, 48, 53, 51, 48, 13, 10, 84, 111, 58, 32, 97, 109, 97, 110, 103, 111, 121, 97, 108, 56, 49, 49, 48, 64, 103, 109, 97, 105, 108, 46, 99, 111, 109, 13, 10, 70, 114, 111, 109, 58, 32, 110, 101, 119, 46, 117, 115, 101, 114, 64, 115, 109, 116, 112, 109, 117, 120, 46, 99, 111, 109, 13, 10, 83, 117, 98, 106, 101, 99, 116, 58, 32, 116, 101, 115, 116, 32, 77, 111, 110, 44, 32, 50, 57, 32, 68, 101, 99, 32, 50, 48, 50, 53, 32, 49, 56, 58, 52, 52, 58, 53, 51, 32, 43, 48, 53, 51, 48, 13, 10, 77, 101, 115, 115, 97, 103, 101, 45, 73, 100, 58, 32, 60, 50, 48, 50, 53, 49, 50, 50, 57, 49, 56, 52, 52, 53, 51, 46, 48, 51, 51, 56, 51, 53, 64, 97, 109, 97, 110, 103, 111, 121, 97, 108, 109, 98, 97, 46, 108, 111, 99, 97, 108, 62, 13, 10, 88, 45, 77, 97, 105, 108, 101, 114, 58, 32, 115, 119, 97, 107, 115, 32, 118, 50, 48, 50, 52, 48, 49, 48, 51, 46, 48, 32, 106, 101, 116, 109, 111, 114, 101, 46, 111, 114, 103, 47, 106, 111, 104, 110, 47, 99, 111, 100, 101, 47, 115, 119, 97, 107, 115, 47, 13, 10, 13, 10, 104, 101, 108, 108, 111, 32, 117, 115, 101, 114, 13, 10, 13, 10, 13, 10}

	if len(expectedArrBytes) != len(newMailDataBytes) {
		t.Errorf("Length of expected and new mail data bytes do not match")
	}

	for i := 0; i < len(expectedArrBytes); i++ {
		if expectedArrBytes[i] != newMailDataBytes[i] {
			t.Errorf("UpdateFromUser isn't working as expected.Byte at index %d does not match", i)
		}
	}

}
